<ul>
  <% itemList.forEach(item => { %>
  <div
    class="block w-full bg-[#FFFCFC] rounded-3xl mb-3 shadow-xl flex justify-start hover:bg-[#F2F3F5] transition duration-150"
    href="#"
  >
    <div class="flex w-20">
      <a
        class="self-start mx-auto mt-1.5 rounded-full w-7/12"
        href="/profile/<%= item.postedBy._id%>"
        ><img
          class="self-start mx-auto rounded-full w-full"
          src="<%- item.postedBy?.image%>"
          alt="user image"
      /></a>
    </div>
    <li class="w-full">
      <div class="flex justify-between pt-2">
        <div class="flex gap-x-1.5">
          <a
            href="/profile/<%= item.postedBy._id%>"
            class="underline font-roboto text-sm"
            ><%= item.postedBy?.displayName%></a
          >

          <div class="text-sm text-neutral-500">
            posted <%= item.createdAt.toLocaleDateString('en-US', { month:
            'short', day: 'numeric' }) %>
          </div>

          <a
            class="text-primary text-sm hover:underline"
            href="<%= item.linkinput %>"
            target="_blank"
            ><%= item.linkinput.replace(/(^\w+:|^)\/\/(www\.)?/, '').slice(0,
            16) + (item.linkinput.length > 16 ? '...' : '') %><i
              class="fa-solid fa-link fa-xs"
              style="color: #3b71ca"
            ></i
          ></a>
        </div>
        <!-- <div class="justify-self-end pr-5">
          <a href=""
            ><i class="fa-solid fa-ellipsis" style="color: #5b7083"></i
          ></a>
        </div> -->
        <div class="justify-self-end pr-5">
          <div class="relative" data-te-dropdown-ref>
            <button
              class=""
              type="button"
              id="dropdownMenuSmallButton"
              data-te-dropdown-toggle-ref
              aria-expanded="false"
              data-te-ripple-init
              data-te-ripple-color="light"
            >
              <i class="fa-solid fa-ellipsis" style="color: #5b7083"></i>
              <!-- <span class="ml-2 w-2">
                
                  <path
                    fill-rule="evenodd"
                    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                    clip-rule="evenodd"
                  />
                </svg>
              </span> -->
            </button>
            <ul
              class="absolute z-[1000] float-left m-0 hidden min-w-max list-none overflow-hidden rounded-lg border-none bg-white bg-clip-padding text-left text-base shadow-lg dark:bg-neutral-700 [&[data-te-dropdown-show]]:block"
              aria-labelledby="dropdownMenuSmallButton"
              data-te-dropdown-menu-ref
            >
              <% if (item.reportedBy.includes(user.id)) { %>
              <li>
                <a
                  class="pointer-events-none block w-full whitespace-nowrap bg-transparent px-4 py-2 text-sm font-normal text-neutral-400 active:text-neutral-800 active:no-underline disabled:pointer-events-none disabled:bg-transparent disabled:text-neutral-400 dark:text-neutral-500 dark:hover:bg-neutral-600"
                  href="#"
                  data-te-dropdown-item-ref
                  >Report post</a
                >
              </li>
              <% } else { %>
              <li>
                <button
                  type="button"
                  class="inline-block rounded bg-light px-6 pb-2 pt-2.5 text-sm font-medium leading-normal text-danger transition duration-150 ease-in-out hover:bg-secondary-200 focus:bg-danger-600 focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:outline-none focus:ring-0 active:bg-danger-700 active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] dark:shadow-[0_4px_9px_-4px_rgba(59,113,202,0.5)] dark:focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] shadow-none"
                  data-te-dropdown-item-ref
                  data-te-toggle="modal"
                  data-te-target="#reportModal<%= item._id %>"
                  data-te-ripple-init
                  data-te-ripple-color="light"
                >
                  Report post
                </button>
                <!-- <a
                  class="block w-full whitespace-nowrap bg-transparent px-4 py-2 text-sm font-normal text-neutral-700 hover:bg-neutral-100 active:text-neutral-800 active:no-underline disabled:pointer-events-none disabled:bg-transparent disabled:text-neutral-400 dark:text-neutral-200 dark:hover:bg-neutral-600"
                  
                  data-te-dropdown-item-ref
                  >Report post</a
                > -->
              </li>

              <% } %> <%if(item.postedBy.id == user.id){ %>
              <li>
                <a
                  class="block w-full whitespace-nowrap bg-transparent px-4 py-2 text-sm font-normal text-neutral-700 hover:bg-neutral-100 active:text-neutral-800 active:no-underline disabled:pointer-events-none disabled:bg-transparent disabled:text-neutral-400 dark:text-neutral-200 dark:hover:bg-neutral-600 text-center"
                  href="/edit/<%= item._id %>"
                  data-te-dropdown-item-ref
                  >Edit post</a
                >
              </li>

              <!-- <li>
                <a
                  class="block w-full whitespace-nowrap bg-transparent px-4 py-2 text-sm font-normal text-neutral-700 hover:bg-neutral-100 active:text-neutral-800 active:no-underline disabled:pointer-events-none disabled:bg-transparent disabled:text-neutral-400 dark:text-neutral-200 dark:hover:bg-neutral-600"
                  href="#"
                  data-te-dropdown-item-ref
                  >Delete</a
                >
              </li> -->

              <li>
                <button
                  type="button"
                  class="w-full inline-block rounded bg-light px-6 pb-2 pt-2.5 text-sm font-medium leading-normal text-danger shadow-[0_4px_9px_-4px_#3b71ca] transition duration-150 ease-in-out hover:bg-secondary-200 hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:bg-danger-600 focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:outline-none focus:ring-0 active:bg-danger-700 active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] dark:shadow-[0_4px_9px_-4px_rgba(59,113,202,0.5)] dark:hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)]"
                  data-te-dropdown-item-ref
                  data-te-toggle="modal"
                  data-te-target="#exampleModal<%= item._id %>"
                  data-te-ripple-init
                  data-te-ripple-color="light"
                >
                  Delete post
                </button>
              </li>
              <%}%>
            </ul>
            <!-- Delete Modal START -->
            <div
              data-te-modal-init
              class="fixed left-0 top-0 z-[1055] hidden h-full w-full overflow-y-auto overflow-x-hidden outline-none"
              id="exampleModal<%= item._id %>"
              tabindex="-1"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div
                data-te-modal-dialog-ref
                class="pointer-events-none relative w-auto translate-y-[-50px] opacity-0 transition-all duration-300 ease-in-out min-[576px]:mx-auto min-[576px]:mt-7 min-[576px]:max-w-[500px]"
              >
                <div
                  class="min-[576px]:shadow-[0_0.5rem_1rem_rgba(#000, 0.15)] pointer-events-auto relative flex w-full flex-col rounded-md border-none bg-white bg-clip-padding text-current shadow-lg outline-none dark:bg-neutral-600"
                >
                  <div
                    class="flex flex-shrink-0 items-center justify-between rounded-t-md border-b-2 border-neutral-100 border-opacity-100 p-4 dark:border-opacity-50"
                  >
                    <!--Modal title-->
                    <h5
                      class="text-xl font-medium leading-normal text-neutral-800 dark:text-neutral-200"
                      id="exampleModalLabel"
                    >
                      Warning: Deleting this post is irreversible. Confirm
                      delete?
                    </h5>
                    <!--Close button-->
                    <button
                      type="button"
                      class="box-content rounded-none border-none hover:no-underline hover:opacity-75 focus:opacity-100 focus:shadow-none focus:outline-none"
                      data-te-modal-dismiss
                      aria-label="Close"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="h-6 w-6"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M6 18L18 6M6 6l12 12"
                        />
                      </svg>
                    </button>
                  </div>

                  <!--Modal body-->
                  <!-- <div class="relative flex-auto p-4" data-te-modal-body-ref>BODY</div> -->

                  <!--Modal footer-->
                  <div
                    class="flex flex-shrink-0 flex-wrap items-center justify-end rounded-b-md border-t-2 border-neutral-100 border-opacity-100 p-4 dark:border-opacity-50"
                  >
                    <button
                      type="button"
                      class="inline-block rounded bg-primary-100 px-6 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-primary-700 transition duration-150 ease-in-out hover:bg-primary-accent-100 focus:bg-primary-accent-100 focus:outline-none focus:ring-0 active:bg-primary-accent-200"
                      data-te-modal-dismiss
                      data-te-ripple-init
                      data-te-ripple-color="light"
                    >
                      Close
                    </button>
                    <a
                      class="ml-1 inline-block rounded bg-danger px-6 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-white shadow-[0_4px_9px_-4px_#3b71ca] transition duration-150 ease-in-out hover:bg-danger-800 hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:bg-danger-600 focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:outline-none focus:ring-0 active:bg-danger-700 active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] dark:shadow-[0_4px_9px_-4px_rgba(59,113,202,0.5)] dark:hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)]"
                      data-te-ripple-init
                      data-te-ripple-color="light"
                      href="/edit/remove/<%= item._id %>"
                    >
                      DELETE POST
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <!-- MODAL END  -->

            <!-- Report Modal START -->
            <div
              data-te-modal-init
              class="fixed left-0 top-0 z-[1055] hidden h-full w-full overflow-y-auto overflow-x-hidden outline-none"
              id="reportModal<%= item._id %>"
              tabindex="-1"
              aria-labelledby="reportModalLabel"
              aria-hidden="true"
            >
              <div
                data-te-modal-dialog-ref
                class="pointer-events-none relative w-auto translate-y-[-50px] opacity-0 transition-all duration-300 ease-in-out min-[576px]:mx-auto min-[576px]:mt-7 min-[576px]:max-w-[500px]"
              >
                <div
                  class="min-[576px]:shadow-[0_0.5rem_1rem_rgba(#000, 0.15)] pointer-events-auto relative flex w-full flex-col rounded-md border-none bg-white bg-clip-padding text-current shadow-lg outline-none dark:bg-neutral-600"
                >
                  <div
                    class="flex flex-shrink-0 items-center justify-between rounded-t-md border-b-2 border-neutral-100 border-opacity-100 p-4 dark:border-opacity-50"
                  >
                    <!--Modal title-->
                    <h5
                      class="text-xl font-medium leading-normal text-neutral-800 dark:text-neutral-200"
                      id="exampleModalLabel"
                    >
                      Reporting is irreversible and should be used to flag
                      irrelevant or inappropriate posts. Are you sure you want
                      to proceed?
                    </h5>
                    <!--Close button-->
                    <button
                      type="button"
                      class="box-content rounded-none border-none hover:no-underline hover:opacity-75 focus:opacity-100 focus:shadow-none focus:outline-none"
                      data-te-modal-dismiss
                      aria-label="Close"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="h-6 w-6"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M6 18L18 6M6 6l12 12"
                        />
                      </svg>
                    </button>
                  </div>

                  <!--Modal body-->
                  <!-- <div class="relative flex-auto p-4" data-te-modal-body-ref>BODY</div> -->

                  <!--Modal footer-->
                  <div
                    class="flex flex-shrink-0 flex-wrap items-center justify-end rounded-b-md border-t-2 border-neutral-100 border-opacity-100 p-4 dark:border-opacity-50"
                  >
                    <button
                      type="button"
                      class="inline-block rounded bg-primary-100 px-6 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-primary-700 transition duration-150 ease-in-out hover:bg-primary-accent-100 focus:bg-primary-accent-100 focus:outline-none focus:ring-0 active:bg-primary-accent-200"
                      data-te-modal-dismiss
                      data-te-ripple-init
                      data-te-ripple-color="light"
                    >
                      Close
                    </button>
                    <a
                      class="ml-1 inline-block rounded bg-danger px-6 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-white shadow-[0_4px_9px_-4px_#3b71ca] transition duration-150 ease-in-out hover:bg-danger-800 hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:bg-danger-600 focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:outline-none focus:ring-0 active:bg-danger-700 active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] dark:shadow-[0_4px_9px_-4px_rgba(59,113,202,0.5)] dark:hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)]"
                      data-te-ripple-init
                      data-te-ripple-color="light"
                      href="/reportPost/<%= item._id %>"
                    >
                      REPORT POST
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <!-- MODAL END  -->
          </div>
        </div>
      </div>

      <a
        href="/viewPost/dashboard/<%= item._id %>"
        class="block text-base font-medium font-roboto pt-2 pb-1.5 mr-3.5 border border-sky-500"
      >
        <%- item.titleinput %>
      </a>

      <% if (item.textinput && item.textinput.length > 0) { %>
      <a
        class="block text-neutral-700 text-sm pb-1.5 mr-3.5 hover:underline transition duration-150"
        href="/viewPost/dashboard/<%= item._id %>"
      >
        <%- item.textinput.length > 145 ? item.textinput.slice(0, 145) + ' ...'
        : item.textinput %>
      </a>
      <% } %>

      <div class="flex gap-1.5 flex-wrap pb-1.5">
        <!-- year bubble -->
        <div class="bg-[#CACACA] py-1.5 px-3 rounded-3xl font-roboto text-sm">
          <%= item.numinput %>
        </div>

        <!-- loop through subregions and generate a div for each item in the array -->
        <% if (item.regioninput.length > 0) { %> <%
        item.regioninput.forEach(region => { %>

        <a
          class="rounded-3xl h-full hover:underline"
          href="/dashboard?regionfilter=<%= region%>&&countryfilter=&healthriskfilter="
        >
          <div
            class="bg-[#BEEDC0] p-1.5 px-2 rounded-3xl font-roboto text-sm hover:bg-[#a0e5a3] transition duration-150"
          >
            <%= region %>
          </div>
        </a>

        <% }); %> <% } %>

        <!-- loop through country input and generate a div for each item in the array -->
        <% if (item.countryinput.length > 0) { %> <%
        item.countryinput.forEach(country => { %>
        <a
          class="rounded-3xl h-full hover:underline"
          href="/dashboard?regionfilter=&&countryfilter=<%= country%>&healthriskfilter="
        >
          <div
            class="bg-[#C6E8F0] p-1.5 px-2 rounded-3xl font-roboto text-sm hover:bg-[#9ED8E5] transition duration-150"
          >
            <%= country %>
          </div>
        </a>
        <% }); %> <% } %>

        <!-- loop through health risks and generate a div for each item in the array -->
        <% if (item.healthriskinput.length > 0) { %> <%
        item.healthriskinput.forEach(healthRisk => { %>
        <a
          class="rounded-3xl h-full hover:underline"
          href="/dashboard?regionfilter=&&countryfilter=&healthriskfilter=<%=healthRisk%>"
        >
          <div
            class="bg-[#E7C6B2] p-1.5 px-2 rounded-3xl font-roboto text-sm hover:bg-[#DBA98B] transition duration-150"
          >
            <%= healthRisk %>
          </div>
        </a>
        <% }); %> <% } %>
      </div>

      <div class="flex justify-start">
        <div class="flex justify-between w-4/6 my-2.5">
          <!-- If the post has 1 comment, ensure the grammar fits accordingly -->
          <% if (item.comments == 1) {%>
          <div title="<%= item.comments %> comment" class="text-neutral-500">
            <i class="fa-regular fa-comment mr-1" style="color: #5b7083"></i><%=
            item.comments %>
          </div>
          <% } else { %>
          <div title="<%= item.comments %> comments" class="text-neutral-500">
            <i class="fa-regular fa-comment mr-1" style="color: #5b7083"></i><%=
            item.comments %>
          </div>
          <% } %>

          <form action="/likePost/<%= item._id %>" class="flex">
            <% if (user.likedPosts.includes(item._id)) { %>
            <!-- If post is already saved by the user, display "Unsave this post" -->
            <button type="submit" title="Unlike post">
              <i class="fa-solid fa-heart mr-1" style="color: #f91880"></i>
            </button>

            <% if (item.likes == 1) {%>
            <div title="<%= item.likes %> like" class="text-neutral-500">
              <%= item.likes %>
            </div>
            <% } else { %>
            <div title="<%= item.likes %> likes" class="text-neutral-500">
              <%= item.likes %>
            </div>
            <% } %> <% } else { %>
            <!-- If post is not saved by the user, display "Save this post" -->
            <button type="submit" title="Like post">
              <i class="fa-regular fa-heart mr-1" style="color: #5b7083"></i>
            </button>
            <!-- If the post has 1 like, ensure the grammar fits accordingly -->
            <% if (item.likes == 1) {%>
            <div class="text-neutral-500" title="<%= item.likes %> like">
              <%= item.likes %>
            </div>
            <% } else { %>
            <div class="text-neutral-500" title="<%= item.likes %> likes">
              <%= item.likes %>
            </div>
            <% } %> <% } %>
          </form>

          <form action="/savePost/<%= item._id %>">
            <% if (user.savedPosts.includes(item._id)) { %>
            <!-- If post is already saved by the user, display "Unsave this post" -->
            <button type="submit" title="Unsave post">
              <i
                class="fa-solid fa-bookmark"
                alt="Unsave"
                style="color: #5b7083"
              ></i>
            </button>
            <% } else { %>
            <!-- If post is not saved by the user, display "Save this post" -->
            <button type="submit" title="Save post">
              <i
                class="fa-regular fa-bookmark"
                alt="Save"
                style="color: #5b7083"
              ></i>
            </button>
            <% } %>
          </form>
        </div>
      </div>

      <!-- <a href="/viewPost/dashboard/<%= item._id %>">View Post</a> -->
    </li>
  </div>

  <% }) %>
</ul>
